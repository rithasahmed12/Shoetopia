          <!-- Order List Section -->
          <% if (orders.length > 0) { %>
            <div class="col-lg-9">
              <div class="card-body p-4">
                <% orders.forEach(order => { %>
                  <% order.items.forEach(item => { %>
                    <% if (order.status !== 'pending') { %>
                   <a href="/single-order/<%= order._id %>?itemId=<%= item._id %>"> <div class="card shadow-0 border mb-4 custom-section-hover">
                      <div class="card-body">
                        <div class="row">
                          <!-- ... (other content) ... -->
                          <div class="col-md-2">
                            <img src="ResizedImages/<%= item.product_id.image[0] %>" class="img-fluid" alt="Product Image">
                          </div>
                          <div class="col-md-2 text-center d-flex justify-content-center align-items-center product-image">
                            <p class="text mb-0" style="font-weight: 550; color: rgb(106, 106, 106);" ><%= item.product_id.name %></p>
                          </div>
                          <div class="col-md-4 text-center d-flex justify-content-center align-items-center">
                            <p class="text-muted mb-0 small"><b>Order Date:</b></p>
                            <p class="text-muted mb-0 small"><%= moment(order.date).format('DD/MM/YYYY') %></p>
                          </div>
      
                          <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                            <p class="text-muted mb-0 small"><b>Qty:</b><%= item.quantity %></p>
                          </div>
                          
                          <div class="col-md-2 text-center d-flex justify-content-center align-items-center">
                            <p class="text-muted mb-0 small">â‚¹<%= item.total_price %></p>
                          </div>
                        </div>
                        <hr class="mb-4" style="background-color: #e0e0e0; opacity: 1;">
                        <div class="row d-flex align-items-center">
                         
                          <div class="col-md-2  d-flex justify-content-center align-items-center">
                            <p class="text-muted mb-0 small"><b>Payment:</b>  </p>
                            <p class="text-muted mb-0 small"> <%= order.payment %></p>
                          </div>
                          <div class="col-md-5  d-flex justify-content-center align-items-center">
                            <p class="text-muted  mb-0 small"><b>Expected Delivery:</b> </p>
                            <% if(item.ordered_status !== 'cancelled' && item.ordered_status !== 'returned' && item.ordered_status !== 'request_cancellation' && item.ordered_status !== 'request_return' && item.ordered_status !== 'delivered') { %>
                            <p class="text-muted mb-0 small"> <%= order.expected_delivery %></p>
                            <% }else{ %>
                              <p class="text-muted mb-0 small">NIL</p>
                           <% } %>
                          </div>
                
                          <div class="col-md-3">
                            <% if (item.ordered_status === 'cancelled') { %>
                              <p class="mb-0 small" style="color: red;"><b>Status:</b> <%= item.ordered_status %></p>
                            <% }else if(item.ordered_status === 'request_cancellation'){ %>
                              <p class="mb-0 small" style="color: red;"><b>Status:</b>cancellation Requested</p>
                            <%} else if (item.ordered_status === 'request_return') { %>
                              <p class="mb-0 small" style="color: red;"><b>Status:</b>return requested</p>
                            <%} else if (item.ordered_status === 'returned') { %>
                              <p class="mb-0 small" style="color: red;"><b>Status:</b><%= item.ordered_status %></p>
                            <%} else if (item.ordered_status === 'delivered') { %>
                              <p class="mb-0 small" style="color: green;"><b>Status:</b> <%= item.ordered_status %></p>
                            <% } else { %>
                              <p class="mb-0 small"><b>Status:</b> <%= item.ordered_status %></p>
                            <% } %>
                          </div>
                          
                        </div>
                      </div>
                    </div>
                    </a>
                    <% } %>
                  <% }) %>
                <% }) %>








                
<section class="gradient-custom mb-0">
    <div class="container-fluid">
        <div class="row">
            <!-- Order Details Card -->
            <div class="col-lg-9" id="Table">
                <div class="card-body p-4">
                    <!-- Heading -->
                    <!-- Order Details Card -->
                    <div class="card shadow mb-4">
                        <div class="card-body">
                            <div class="row">
                                <!-- Order Information -->
                                <div class="col-md-4">
                                    <!-- Order ID -->
                                    <p><strong>Order ID:</strong> <%= order._id %></p>
                                    <!-- Order Date -->
                                   <!-- Include moment.js library -->
  
  
                                      <p><strong>Order Date:</strong> <%= moment(order.date).format('DD/MM/YYYY') %></p>
  
                                    <!-- Expected Delivery Date -->
                                    <% if(order.order.ordered_status !== 'cancelled' && order.orderItem.ordered_status !== 'returned' && order.orderItem.ordered_status !== 'request_cancellation' && order.orderItem.ordered_status !== 'request_return' && order.orderItem.ordered_status !== 'delivered') { %>
                                      <p><strong>Expected Delivery:</strong> <%= order.mainOrder.expected_delivery %></p>
                                      <% }else{ %>
                                          <p><strong>Expected Delivery:</strong> NIL</p>
                                     <% } %>
  
                                   
                                    
                                    <!-- Delivery Address -->
                                    <p><strong>Delivery Address:</strong> <%= order.mainOrder.delivery_address %></p>
                                </div>
  
                                <!-- Order Tracking Bar -->
                                <div class="col-md-6">
                                    <div class="order-status-bar">
                                        <div class="progress">
                                            <div class="progress-bar progress-bar-striped bg-primary" role="progressbar"
                                                style="width: <%= calculateProgress(order.orderItem.ordered_status) %>"
                                                aria-valuenow="<%= calculateProgress(order.orderItem.ordered_status) %>"
                                                aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <div class="order-status-labels">
                                            <div class="row">
                                                <!-- Order Status Labels -->
                                                <span class="col-2"></span>
                                                <span class="col-2 order-status-label <%= order.orderItem.ordered_status === 'placed' ? 'active' : '' %>">Placed</span>
                                                <span class="col-2 order-status-label <%= order.orderItem.ordered_status === 'shipped' ? 'active' : '' %>">Shipped</span>
                                                <span class="col-3 order-status-label <%= order.orderItem.ordered_status === 'out_for_delivery' ? 'active' : '' %>">Out for Delivery</span>
                                                <span class="col-3 order-status-label <%= order.orderItem.ordered_status === 'delivered' ? 'active' : '' %>">Delivered</span>
                                            </div>
                                        </div>
                                    </div>
  
                                    <% if (order.orderItem.ordered_status === 'delivered') { %>
  
                                      <% const currentDate = new Date(); %>
                                      <% const returnPolicyDays = 7; %> <!-- Set the return policy days -->
                                      
                                      <!-- Calculate the return expiry date based on the current date -->
                                      <% const returnExpiryDate = new Date(order.mainOrder.date); %>
                                      <% console.log('gunda',returnExpiryDate) %>
                                      <% returnExpiryDate.setDate(returnExpiryDate.getDate() + returnPolicyDays); %>
                                  
                                      <!-- Show Return Button -->
                                      <% if (currentDate <= returnExpiryDate) { %>
                                          <button class="btn btn-primary float-end mt-4" style="width: 100px;" onclick="returnOrder()">Return Order</button>
                                          <p class="text-muted mt-3" id="return-text">Please note that order returns are only possible within <%= returnPolicyDays %> days from the delivery date.</p>
                                      <% } else { %>
                                          <p class="text-muted mt-3">Return expired</p>
                                      <% } %>
                                  
                                  
                                  
                                  
                                  
  
                                    <% } else if (!['request_cancellation', 'cancelled', 'request_return', 'returned'].includes(order.orderItem.ordered_status)) { %>
                                        <!-- Show Cancel Button -->
                                        <button class="btn btn-primary float-end mt-4" style="width: 100px;" onclick="cancelOrder()">Cancel Order</button>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
  
            <!-- Product Details Card -->
            <div class="col-lg-9" id="Table">
                <div class="card-body p-4">
                    <div class="card shadow mb-4">
                        <div class="card-body">
                            <div class="d-flex">
                                <div class="me-3">
                                    <img src="/ResizedImages/<%= order.orderItem.product_id.image[0] %>"
                                        class="img-fluid" alt="<%= order.orderItem.product_id.name %>" width="150rem">
                                </div>
                                <div style="margin-left: 10px;">
                                    <h4 class="card-title display-6">
                                        <%= order.orderItem.product_id.name %>
                                    </h4>
                                    <span class="font-size:20px text-secondary ms-4"><b>Category</b>: <%= order.orderItem.product_id.category %></span><br>
                                    <span class="card-text text-secondary ms-4">Quantity: <%= order.orderItem.quantity %></span>
                                    <h5 class="card-title mt-2 ms-4">â‚¹<%= order.orderItem.total_price %></h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </section>